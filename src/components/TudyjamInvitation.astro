---
interface Props {}
---

<div class="container">
  {
    new Array(4).fill(0).map((i) => (
      <a class="alt invit" href="/tudyjam">
        <img
          class="invitation"
          src="/tudyjam/dont_tudyjam_at_3_am.png"
          alt="Tudyjam invitation card"
        />
      </a>
    ))
  }
</div>

<!-- Randomly offset the tudyjams -->
<script>
  let es = Array.from(document.querySelectorAll("a.invit")!);

  const moveToRandomX = (e) => {
    e.style.left =
      Math.ceil(
        Math.random() *
          (window.innerWidth - e.getBoundingClientRect().width - 10)
      ) + "px";
  };
  const moveToRandomY = (e) => {
    e.style.top =
      window.scrollY +
      Math.ceil(
        Math.random() *
          (window.innerHeight - e.getBoundingClientRect().height - 5)
      ) +
      "px";
  };

  const moveToRandomPos = (e) => {
    moveToRandomX(e);
    moveToRandomY(e);
  };

  const checkWindowSize = () => {
    es.forEach((e) => {
      let rect = e.getBoundingClientRect();
      console.log(rect.x, rect.width, window.innerWidth);
      if (
        rect.right > window.innerWidth ||
        rect.left < 0 ||
        rect.top < 0 ||
        rect.bottom > window.innerHeight
      ) {
        moveToRandomPos(e);
      }
    });
  };

  const elemScroll = () => {
    es.forEach((e) => {
      let rect = e.getBoundingClientRect();
      if (rect.top < 0 || rect.bottom > window.innerHeight) {
        moveToRandomPos(e);
      }
    });
  };

  window.addEventListener("resize", checkWindowSize);
  //   window.addEventListener("scroll", elemScroll);

  es.forEach((e) => {
    e.velocity = 0;
    e.increase = Math.random() / 7;
    if (e.increase < 0.01) {
      e.increase = 0.01;
    } else if (e.increase > 0.2) {
      e.increase = 0.2;
    }
    e.style.top = "0px";
    e.style.left = "0px";

    e.velocity = 0;
    e.style.top = "0px";
    moveToRandomX(e);
    e.style.scale = Math.min(0.5, Math.max(1, Math.random())).toString();
    e.maxVel = 10;
  });

  es[0].increase = 0.025;
  es[0].maxVel = 5;

  setInterval(() => {
    es.forEach((e) => {
      e.velocity += e.increase;
      if (e.velocity > e.maxVel) {
        e.velocity = e.maxVel;
      }
      e.style.top = parseFloat(e.style.top.slice(0, -2)) + e.velocity + "px";
      let rect = e.getBoundingClientRect();
      let limit = document
        .querySelector("body")!
        .getBoundingClientRect().height;
      limit -= rect.height - 100;
      if (limit < window.innerHeight) {
        limit = window.innerHeight - rect.height - 100;
      }
      if (parseFloat(e.style.top.slice(0, -2)) >= limit) {
        e.velocity = 0;
        e.style.top = Math.random() * 10 + "px";
        // e.style.scale = Math.min(0.25, Math.max(0.8, Math.random())).toString();
        moveToRandomX(e);
      }
    });
  }, 0.1);
</script>

<style>
  .container {
    overflow: hidden;
  }

  a {
    position: absolute;
    z-index: 1;
    scale: 1;
  }

  img {
    max-width: 60vw;
  }
</style>
